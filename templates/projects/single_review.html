{% load static %}
{% load widget_tweaks %}

<!DOCTYPE html>
<html lang="en">

	<!-- begin::Head -->
	<head>
		<meta charset="utf-8" />
		<title>Metronic | Dashboard</title>
		<meta name="description" content="Latest updates and statistic charts">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no">

		<!--begin::Web font -->
		<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.16/webfont.js"></script>

		<!--end::Web font -->

        <!--begin::Global Theme Styles -->
        
		<link href="{% static 'assets/vendors/base/vendors.bundle.css'%}" rel="stylesheet" type="text/css" />

		<!--RTL version:<link href="../assets/vendors/base/vendors.bundle.rtl.css" rel="stylesheet" type="text/css" />-->
		<link href="{% static 'assets/demo/default/base/style.bundle.css' %}" rel="stylesheet" type="text/css" />

		<link href="{% static 'assets/demo/default/base/custom.css' %}" rel="stylesheet" type="text/css" />

		<!--RTL version:<link href="../assets/demo/default/base/style.bundle.rtl.css" rel="stylesheet" type="text/css" />-->

		<!--end::Global Theme Styles -->

		<!--begin::Page Vendors Styles -->
		<link href="{% static 'assets/vendors/custom/fullcalendar/fullcalendar.bundle.css' %}" rel="stylesheet" type="text/css" />

		<!--RTL version:<link href="../assets/vendors/custom/fullcalendar/fullcalendar.bundle.rtl.css" rel="stylesheet" type="text/css" />-->
		<link href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.css" rel="stylesheet">
		<!--end::Page Vendors Styles -->
		<link rel="shortcut icon" href="{% static 'assets/demo/default/media/img/logo/favicon.ico' %}" />
	</head>

	<!-- end::Head -->

	<!-- begin::Body -->
	<!-- begin::Body -->
	<body class="m-page--fluid m--skin- m-content--skin-light2 m-header--fixed m-header--fixed-mobile m-aside-left--enabled m-aside-left--skin-dark m-aside-left--fixed m-aside-left--offcanvas m-footer--push m-aside--offcanvas-default" onload="$('#graphDiv').hide()">

		<!-- begin:: Page -->
		<div class="m-grid m-grid--hor m-grid--root m-page">

			<!-- BEGIN: Header -->
			<header id="m_header" class="m-grid__item    m-header " m-minimize-offset="200" m-minimize-mobile-offset="200">
				<div class="m-container m-container--fluid m-container--full-height">
					<div class="m-stack m-stack--ver m-stack--desktop">

						<!-- BEGIN: Brand -->
						<div class="m-stack__item m-brand  m-brand--skin-dark ">
							<div class="m-stack m-stack--ver m-stack--general">
								<div class="m-stack__item m-stack__item--middle m-brand__logo">
									<a href="javascript:void(0)" class="m-brand__logo-wrapper">
										<img style="width: 133px;" alt=""  src="{% static 'assets/demo/default/media/img/logo/mylogo.png' %}">
									</a>
								</div>
								<div class="m-stack__item m-stack__item--middle m-brand__tools">

									<!-- BEGIN: Left Aside Minimize Toggle -->
									<a href="javascript:;" id="m_aside_left_minimize_toggle" class="m-brand__icon m-brand__toggler m-brand__toggler--left m--visible-desktop-inline-block  ">
										<span></span>
									</a>

									<!-- END -->

									<!-- BEGIN: Responsive Aside Left Menu Toggler -->
									<a href="javascript:;" id="m_aside_left_offcanvas_toggle" class="m-brand__icon m-brand__toggler m-brand__toggler--left m--visible-tablet-and-mobile-inline-block">
										<span></span>
									</a>

									<!-- END -->

								
								</div>
							</div>
						</div>

						<!-- END: Brand -->
						
					</div>
				</div>
			</header>

			<!-- END: Header -->

			<!-- begin::Body -->
			<div class="m-grid__item m-grid__item--fluid m-grid m-grid--ver-desktop m-grid--desktop m-body">

				<!-- BEGIN: Left Aside -->
				<button class="m-aside-left-close  m-aside-left-close--skin-dark " id="m_aside_left_close_btn"><i class="la la-close"></i></button>
				<div id="m_aside_left" class="m-grid__item	m-aside-left  m-aside-left--skin-dark ">

					<!-- BEGIN: Aside Menu -->
					<div id="m_ver_menu" class="m-aside-menu  m-aside-menu--skin-dark m-aside-menu--submenu-skin-dark " m-menu-vertical="1" m-menu-scrollable="1" m-menu-dropdown-timeout="500" style="position: relative;">
						<ul class="m-menu__nav  m-menu__nav--dropdown-submenu-arrow ">
							<li class="m-menu__item  m-menu__item--submenu" aria-haspopup="true" m-menu-submenu-toggle="hover"><a href="javascript:;" class="m-menu__link m-menu__toggle"><i class="m-menu__link-icon flaticon-layers"></i><span class="m-menu__link-text">Project</span><i class="m-menu__ver-arrow la la-angle-right"></i></a>
								<div class="m-menu__submenu "><span class="m-menu__arrow"></span>
									<ul class="m-menu__subnav">
										<li class="m-menu__item " aria-haspopup="true"><a href="{% url 'createproject' %}" class="m-menu__link "><i class="m-menu__link-bullet fa fa-plus"><span></span></i><span class="m-menu__link-text">Create Project</span></a></li>
										<li class="m-menu__item " aria-haspopup="true"><a href="{% url 'index'%}" class="m-menu__link "><i class="m-menu__link-bullet m-menu__link-bullet--dot"><span></span></i><span class="m-menu__link-text">View Project</span></a></li>
										
									</ul>
								</div>
							</li>
							<li class="m-menu__item  m-menu__item--active" aria-haspopup="true"><a href="{% url 'single_review'%}" class="m-menu__link "><i class="m-menu__link-icon fa fa-pencil-alt""></i><span class="m-menu__link-title"> <span class="m-menu__link-wrap"> <span class="m-menu__link-text">Single Review</span>
											<span class="m-menu__link-badge"></span> </span></span></a></li>
										<form action="{% url 'logout' %}" id="logout" method="post">
												{% csrf_token %}
												<input type="hidden">
											</form>
							<li class="m-menu__item " aria-haspopup="true"><a style="cursor:pointer;" onclick="logout()" class="m-menu__link "><i class="m-menu__link-icon fa fa-sign-out-alt"></i><span class="m-menu__link-title"> <span class="m-menu__link-wrap"> <span class="m-menu__link-text">Logout</span>
											<span class="m-menu__link-badge"></span> </span></span></a></li>
							
							
						</ul>
					</div>

					<!-- END: Aside Menu -->
				</div>

				<!-- END: Left Aside -->
				<div class="m-grid__item m-grid__item--fluid m-wrapper">

					<!-- BEGIN: Subheader --
					<div class="m-subheader ">
						<div class="d-flex align-items-center">
							<div class="mr-auto">
								<h3 class="m-subheader__title ">Create Project</h3>
							</div>
						</div>
					</div>

					<!-- END: Subheader -->
					<div class="m-content">
						<div class="row">
							<div class="col-lg-12">

								<!--begin::Portlet-->
								<div class="m-portlet">
									<div class="m-portlet__head">
										<div class="m-portlet__head-caption">
											<div class="m-portlet__head-title">
												<span class="m-portlet__head-icon m--hide">
													<i class="la la-gear"></i>
												</span>
												<h3 class="m-portlet__head-text fw-800">
													<i class="fa fa-comment-alt"></i> Single Review Analysis
												</h3>
											</div>
										</div>
									</div>

									<!--begin::Form-->
									<form class="m-form" method="POST">
									    {% csrf_token %}
										<div class="m-portlet__body">
											<div class="m-form__section m-form__section--first">
												<div class="form-group m-form__group">
													<label>Enter review:</label>
                                                    <!-- <input type="text" class="form-control m-input" placeholder="Enter Project Description"> -->
                                                    <textarea name="sentence" cols="40" rows="10" id="description" placeholder="Enter review..." class="form-control m-input" required></textarea>
												</div>
												<h4><b>Predicted Rating</b></h4>
												<div class="form-group m-form__group" id="starRating" style="padding-top:0 !important;"></div>
												
											</div>
											</div>
											
											<div class="m-portlet__foot m-portlet__foot--fit">
												<div class="m-form__actions">
													<button type="submit" class="btn btn-success"><i class="fa fa-check-circle"> </i> Submit</button>
													
												</div>
											</div>
									</form>

									<!--end::Form-->
								</div>

								<!--end::Portlet-->
							</div>
							
						</div>
					</div>
					<!-- Chart container starts-->
					<div class="m-content" id="graphDiv">
						<div class="row">
							<div class="col-lg-12">

								<!--begin::Portlet-->
								<div class="m-portlet">
									<div class="m-portlet__head">
										<div class="m-portlet__head-caption">
											<div class="m-portlet__head-title">
												<span class="m-portlet__head-icon m--hide">
													<i class="la la-gear"></i>
												</span>
												<h3 class="m-portlet__head-text fw-800">
													<i class="fa fa-chart-bar"> </i>Graphical Analysis
												</h3>
											</div>
										</div>
									</div>

									
									<div class="m-portlet__body">
										<div class="row align-items-center">
											<div class="col-md-6" id="chartParent">
												<canvas id="myChart"></canvas>
											</div>
											<!-- <div class="col-md-6">
												<div class="" id="sresult">
													<div class="m-alert__icon"></div>
													<div class="m-alert__text">
														<strong><span></span></strong>
													</div>
												</div>
											</div> -->
											<div class="col-md-6">
												<div class="" id="sresult">
													<div class="m-alert__icon"></div>
													<div class="m-alert__text">
														<strong><span></span></strong>
													</div>
												</div>
												<div class="m-widget16">
													<div class="row">
														<div class="col-md-12">
															<div class="m-widget16__stats">
																<div class="m-widget16__visual" id="donutChart">
																	<div id="m_chart_support_tickets" style="height: 180px">
																	</div>
																</div>
																<div class="m-widget16__legends">
																	<div class="m-widget16__legend">
																		<span class="m-widget16__legend-bullet m--bg-success"></span>
																		<span class="m-widget16__legend-text positive_donut"></span>
																	</div>
																	<div class="m-widget16__legend">
																		<span class="m-widget16__legend-bullet m--bg-warning"></span>
																		<span class="m-widget16__legend-text neutral_donut"></span>
																	</div>
																	<div class="m-widget16__legend">
																		<span class="m-widget16__legend-bullet m--bg-danger"></span>
																		<span class="m-widget16__legend-text negative_donut"></span>
																	</div>
																</div>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
										
									</div>



								</div>

								<!--end::Portlet-->
							</div>
							
						</div>
					</div>
					<!-- chart container ends-->
					
				</div>
			</div>


			<!-- end:: Body -->

			<!-- begin::Footer -->
			<footer class="m-grid__item		m-footer ">
				<div class="m-container m-container--fluid m-container--full-height m-page__container">
					<div class="m-stack m-stack--flex-tablet-and-mobile m-stack--ver m-stack--desktop">
						<div class="m-stack__item m-stack__item--left m-stack__item--middle m-stack__item--last">
							<span class="m-footer__copyright">
								2020 &copy;  SIH Project
							</span>
						</div>
						
					</div>
				</div>
			</footer>

			<!-- end::Footer -->
		</div>

		<!-- end:: Page -->

		
		<!-- begin::Scroll Top -->
		<div id="m_scroll_top" class="m-scroll-top">
			<i class="la la-arrow-up"></i>
		</div>
		<script
		src="https://code.jquery.com/jquery-3.4.1.min.js"
		integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
		crossorigin="anonymous"></script>

		<!-- end::Scroll Top -->
		<script src= "https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.min.js" type="text/javascript"></script>

		<script>
			
			function uploadAjax(event) {
				event.preventDefault();
				var data = new FormData($('.m-form').get(0));
				// removes old charts data
				$('#myChart').remove();
				$("#chartParent").append('<canvas id="myChart"></canvas>');
				$("#m_chart_support_tickets").remove();
				$("#donutChart").append('<div id="m_chart_support_tickets" style="height: 180px"></div>');
				
				//
				
				$.ajax({
					url: "/projects/single_review",
					type: "POST",
					data: data,
					cache: false,
					processData: false,
					contentType: false,
					success: function(data) {
						//console.log(JSON.parse(data));
						$("#sresult").removeClass();
						$("#sresult").addClass("m-alert m-alert--icon m-alert--air");
						$('#graphDiv').show();
						var cd = JSON.parse(data);
						console.log(cd)
						displayChart(cd.sentiment);
						$("#starRating").html(getStars(cd.rating));
						if(cd.sentiment['compound']>=0.05){
							$("#sresult").addClass("alert alert-success");
							$(".m-alert__icon").html("<i class='fa fa-smile'> </i> ");
							$(".m-alert__text span").html("Positive Sentiment");
						}
						else if(cd.sentiment['compound'] > -0.05 && cd.sentiment['compound']<0.05){
							$("#sresult").addClass("alert alert-warning");
							$(".m-alert__icon").html("<i class='fa fa-meh'> </i> ");
							$(".m-alert__text span").html("Neutral Sentiment");
						}
						else if(cd.sentiment['compound'] <= -0.05){
							$("#sresult").addClass("alert alert-danger");
							$(".m-alert__icon").html("<i class='fa fa-frown'> </i> ");
							$(".m-alert__text span").html("Negative Sentiment");
						}
						//document.getElementsByClassName("m-form")[0].reset();
						//alert('success');
					}
				});
				return false;
			}
				
			$(function() {
				$('.m-form').submit(uploadAjax);
				
			});

			function displayChart(chartdata){
				var ctx = document.getElementById('myChart');
				var myChart = new Chart(ctx, {
				    type: 'bar',
				    data: {
				        labels: ['Positive', 'Neutral', 'Negative'],
				        datasets: [{
				            label: '% Sentiment Analysis',
				            data: [chartdata['pos']*100,chartdata['neu']*100,chartdata['neg']*100],
				            backgroundColor: [
				                '#a4dfdf',
				                '#ffb822',
				                '#ffb0c1'
				            ],
				            borderColor: [
				                '#70cdcdcd',
				                '#ffb822',
				                '#ff6283'
				            ],
				            borderWidth: 2
				        }]
				    },
				    options: {
				        scales: {
				            yAxes: [{
				                ticks: {
				                    beginAtZero: true
				                }
				            }]
				        }
				    }
				});

				$("#m_chart_support_tickets").length&&Morris.Donut( {
	                element:"m_chart_support_tickets", data:[ {
	                    label: "Positive", value: chartdata['pos']*100
	                }
	                , {
	                    label: "Negative", value: chartdata['neg']*100
	                }
	                , {
	                    label: "Neutral", value: chartdata['neu']*100
	                }
	                ], labelColor:"#a7a7c2", colors:[mApp.getColor("success"), mApp.getColor("danger"), mApp.getColor("warning")]
	            }
    			),
    			$(".positive_donut").html(chartdata["pos"]*100+"% Positive");
    			$(".neutral_donut").html(chartdata["neu"]*100+"% Neutral");
    			$(".negative_donut").html(chartdata["neg"]*100+"% Negative");
			}
			function getStars(rating) {

			  // Round to nearest half
				  rating = Math.round(rating * 2) / 2;
				  let output = [];

				  // Append all the filled whole stars
				  for (var i = rating; i >= 1; i--)
				    output.push('<i class="fa fa-star" aria-hidden="true" style="color: gold;"></i>&nbsp;');

				  // If there is a half a star, append it
				  if (i == .5) output.push('<i class="fa fa-star-half-o" aria-hidden="true" style="color: gold;"></i>&nbsp;');

				  // Fill the empty stars
				  for (let i = (5 - rating); i >= 1; i--)
				    output.push('<i class="fa fa-star-o" aria-hidden="true" style="color: gold;"></i>&nbsp;');

				  return output.join('');

			}

		</script>	


		<!--begin::Global Theme Bundle -->
		<script src="{% static 'assets/vendors/base/vendors.bundle.js' %}" type="text/javascript"></script>
		<script src="{% static 'assets/demo/default/base/scripts.bundle.js' %}" type="text/javascript"></script>

		<!--end::Global Theme Bundle -->

		<!--begin::Page Vendors -->
		<script src="{% static 'assets/vendors/custom/fullcalendar/fullcalendar.bundle.js' %}" type="text/javascript"></script>

		<!--end::Page Vendors -->

		<!--begin::Page Scripts -->
		<script src="{% static 'assets/app/js/dashboard.js' %}" type="text/javascript"></script>

		<!--end::Page Scripts -->
		
		<script>
		function logout() {
			document.getElementById('logout').submit();
		}
	</script>
	</body>

	<!-- end::Body -->
</html>
